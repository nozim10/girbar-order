<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Menu</title>
  <style>
    body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; margin-top: 50px; }
    .item { display: flex; align-items: center; margin: 10px 0; gap: 10px; }
    .item input { width: 50px; padding: 5px; }
    #total { margin-top: 20px; font-weight: bold; }
    button { margin-top: 20px; padding: 10px 20px; }
  </style>
</head>
<body>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <h1>Menu</h1>
  <div id="menu-container"></div>
  <div id="total">Total: $0.00</div>
  <button onclick="submitOrder()">Done</button>

  <script>
    console.log("Telegram.WebApp:", Telegram?.WebApp);
    const menuItems = [
      { id: 1, name: "Latte", price: 3.5 },
      { id: 2, name: "Croissant", price: 2.0 },
      { id: 3, name: "Espresso", price: 2.5 }
    ];

    const menuContainer = document.getElementById("menu-container");

    menuItems.forEach(item => {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <span>${item.name} ($${item.price.toFixed(2)})</span>
        <input type="number" min="0" value="0" id="item-${item.id}">
      `;
      menuContainer.appendChild(div);
    });

    function updateTotal() {
      let total = 0;
      menuItems.forEach(item => {
        const qty = parseInt(document.getElementById(`item-${item.id}`).value);
        if (!isNaN(qty)) total += qty * item.price;
      });
      document.getElementById("total").innerText = `Total: $${total.toFixed(2)}`;
    }

    menuItems.forEach(item => {
      document.getElementById(`item-${item.id}`).addEventListener("input", updateTotal);
    });

    function submitOrder() {
      const orderItems = menuItems
        .map(item => ({ name: item.name, qty: parseInt(document.getElementById(`item-${item.id}`).value) }))
        .filter(i => i.qty > 0);

      if (orderItems.length === 0) {
        alert("Please select at least one item.");
        return;
      }

      const order = { items: orderItems };

      // Send to bot and close Web App
      Telegram.WebApp.sendData(JSON.stringify(order));
      Telegram.WebApp.close();
    }
  </script>
</body>
</html>
